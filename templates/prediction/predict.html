{% extends 'base.html' %}

{% block content %}
<div class="container">
    <!-- Introduce your web app -->
    <div class="row justify-content-center mt-0">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="card bg-light rounded">
                <div class="card-body text-center">
                    <h1 class="card-title display-4">Welcome!</h1>
                    <p class="card-text lead">Discover the potential of our Skin Cancer Detection App. Simply upload a clear, close-up image of the skin condition and our Deep Learning Model will analyze it and provide a prediction.</p>
                </div>
            </div>
        </div>
    </div>
    <form method="POST" action="{% url 'predict' %}" enctype="multipart/form-data" class="border rounded p-4 mt-3 mx-auto border-primary border-1" style="max-width: 500px;" id="file-upload-form">
        {% csrf_token %}
        <div class="d-flex flex-column align-items-center">
            <input type="file" name="image" id="file-upload" class="d-none" accept="image/*" required>
            <input type="file" name="image" id="camera-input" class="d-none" accept="image/*" capture="environment">
            <label for="file-upload" class="d-flex flex-column align-items-center dropzone text-center text-secondary" style="cursor: pointer;">
                <img src="" id="image-preview" class="img-fluid" style="max-height: 200px; display: none;">
                <i class="bi bi-cloud-arrow-up h1"></i>
                <span>Drag and drop your image</span>
                <span class="text-xs">or</span>
                <span class="btn btn-primary">Select image</span>
                <span class="text-xs">or</span>
                <label for="camera-input" class="btn btn-primary mt-2">Capture with camera</label>
            </label>
            <span class="text-secondary text-xs">Allowed Format: PNG, JPG up to 10MB</span>
        </div>

        <div class="form-group mt-3">
            <label for="id_note">Note (Optional)</label>
            <input type="text" name="note" id="id_note" class="form-control" placeholder="Write a note for the image">
        </div>
        <div class="text-center mt-3">
            <button type="submit" class="btn btn-success">Predict</button>
        </div>
    </form>
    <!-- Loading spinner -->
    <div id="loading" style="display: none; position: fixed; z-index: 1000; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 20px; border-radius: 10px;">
        image processing underway, please wait...
    </div>
</div>

{% block extra_js %}
<script>
    var dropzone = document.querySelector('.dropzone');
    var fileInput = document.querySelector('#file-upload');
    var cameraInput = document.querySelector('#camera-input');
    var preview = document.querySelector('#image-preview');
    var loading = document.querySelector('#loading');  // Added line
    
    function handleFiles(files) {
        fileInput.files = files;
        if (files.length > 0) {
            dropzone.querySelector('span').textContent = files[0].name;
            var reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(files[0]);
        }
    }

    dropzone.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('dragging');
    });

    dropzone.addEventListener('dragleave', function(e) {
        this.classList.remove('dragging');
    });

    dropzone.addEventListener('drop', function(e) {
        e.preventDefault();
        handleFiles(e.dataTransfer.files);
        this.classList.remove('dragging');
    });

    fileInput.addEventListener('change', function(e) {
        handleFiles(fileInput.files);
    });

    cameraInput.addEventListener('change', function(e) {
        handleFiles(cameraInput.files);
    });

    // Show loading spinner when form is submitted
    document.querySelector('#file-upload-form').addEventListener('submit', function(e) {
        loading.style.display = 'block';
    });
</script>
{% endblock %}

{% endblock %}
